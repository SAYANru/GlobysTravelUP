<Page x:Class="GlobusTravelManager.Views.ToursPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      Title="Управление турами">

    <Grid Margin="10">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Панель управления -->
        <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,10">
            <Button Content="➕ Добавить тур" Width="120" Height="35" 
                    Background="#4CAF50" Foreground="White"
                    Click="BtnAddTour_Click"/>

            <Button Content="✏️ Редактировать" Width="120" Height="35" Margin="10,0,0,0"
                    Background="#2196F3" Foreground="White"
                    Click="BtnEditTour_Click"/>

            <Button Content="🗑️ Удалить" Width="120" Height="35" Margin="10,0,0,0"
                    Background="#F44336" Foreground="White"
                    Click="BtnDeleteTour_Click"/>

            <Button Content="🔄 Обновить" Width="120" Height="35" Margin="10,0,0,0"
                    Click="BtnRefresh_Click"/>
        </StackPanel>

        <!-- Панель фильтров -->
        <Border Grid.Row="1" Background="#F9F9F9" BorderBrush="#DDD" BorderThickness="1"
                Padding="10" Margin="0,0,0,10">
            <StackPanel Orientation="Horizontal">
                <Label Content="Поиск:" VerticalAlignment="Center"/>
                <TextBox x:Name="txtSearch" Width="200" Height="25" Margin="5,0,20,0"
                         TextChanged="TxtSearch_TextChanged"/>

                <Label Content="Страна:" VerticalAlignment="Center"/>
                <ComboBox x:Name="cmbCountry" Width="120" Height="25" Margin="5,0,20,0"/>

                <Label Content="Сортировка:" VerticalAlignment="Center"/>
                <ComboBox x:Name="cmbSort" Width="120" Height="25" Margin="5,0,0,0"
                          SelectionChanged="CmbSort_SelectionChanged">
                    <ComboBoxItem Content="По дате (возр.)"/>
                    <ComboBoxItem Content="По дате (убыв.)"/>
                    <ComboBoxItem Content="По цене (возр.)"/>
                    <ComboBoxItem Content="По цене (убыв.)"/>
                    <ComboBoxItem Content="По названию"/>
                </ComboBox>
            </StackPanel>
        </Border>

        <!-- Список туров -->
        <DataGrid x:Name="dgTours" Grid.Row="2" 
                  AutoGenerateColumns="False" IsReadOnly="True"
                  CanUserAddRows="False" SelectionMode="Single">

            <DataGrid.Columns>
                <DataGridTextColumn Header="ID" Binding="{Binding Id}" Width="40"/>

                <!-- Фото -->
                <DataGridTemplateColumn Header="Фото" Width="70">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <Image Source="{Binding PhotoFileName, Converter={StaticResource ImagePathConverter}}"
                                   Width="60" Height="40" Stretch="Uniform"/>
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>

                <DataGridTextColumn Header="Тур" Binding="{Binding Name}" Width="220"/>
                <DataGridTextColumn Header="Страна" Binding="{Binding CountryName}" Width="100"/>
                <DataGridTextColumn Header="Дата" 
                                    Binding="{Binding StartDate, StringFormat=dd.MM.yyyy}" 
                                    Width="90"/>
                <DataGridTextColumn Header="Цена" 
                                    Binding="{Binding Price, StringFormat=N0 руб.}" 
                                    Width="100"/>
                <DataGridTextColumn Header="Мест" Binding="{Binding Capacity}" Width="50"/>
                <DataGridTextColumn Header="Свободно" Binding="{Binding AvailableSeats}" Width="70"/>
				<DataGridTemplateColumn Header="Статус" Width="100">
					<DataGridTemplateColumn.CellTemplate>
						<DataTemplate>
							<TextBlock>
								<TextBlock.Style>
									<Style TargetType="TextBlock">
										<Style.Triggers>
											<DataTrigger Binding="{Binding AvailableSeats}" Value="0">
												<Setter Property="Text" Value="Нет мест"/>
												<Setter Property="Foreground" Value="Red"/>
												<Setter Property="FontWeight" Value="Bold"/>
											</DataTrigger>
											<DataTrigger Binding="{Binding AvailableSeats}" Value="0">
												<Setter Property="Text" Value="Есть места"/>
												<Setter Property="Foreground" Value="Green"/>
											</DataTrigger>
										</Style.Triggers>
									</Style>
								</TextBlock.Style>
							</TextBlock>
						</DataTemplate>
					</DataGridTemplateColumn.CellTemplate>
				</DataGridTemplateColumn>
            </DataGrid.Columns>
        </DataGrid>

        <!-- Статистика -->
        <StackPanel Grid.Row="3" Orientation="Horizontal" Margin="0,10,0,0">
            <TextBlock Text="Всего туров:" FontWeight="Bold"/>
            <TextBlock x:Name="tbTotalTours" Text="0" FontWeight="Bold" Margin="5,0,20,0"/>

            <TextBlock Text="Доступных:" FontWeight="Bold" Foreground="Green"/>
            <TextBlock x:Name="tbAvailableTours" Text="0" FontWeight="Bold" Foreground="Green" Margin="5,0,20,0"/>

            <TextBlock Text="Нет мест:" FontWeight="Bold" Foreground="Red"/>
            <TextBlock x:Name="tbNoSeatsTours" Text="0" FontWeight="Bold" Foreground="Red" Margin="5,0,0,0"/>
        </StackPanel>
    </Grid>
</Page>