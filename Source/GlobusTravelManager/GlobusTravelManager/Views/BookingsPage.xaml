<Page x:Class="GlobusTravelManager.Views.BookingsPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      Title="Управление заявками">

	<Grid Margin="10">
		<Grid.RowDefinitions>
			<RowDefinition Height="Auto"/>
			<RowDefinition Height="Auto"/>
			<RowDefinition Height="*"/>
			<RowDefinition Height="Auto"/>
		</Grid.RowDefinitions>

		<!-- Панель управления -->
		<StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,10">
			<Button Content="➕ Новая заявка" Width="120" Height="35"
                    Background="#4CAF50" Foreground="White"
                    Click="BtnNewBooking_Click"/>

			<Button Content="✅ Подтвердить" Width="120" Height="35" Margin="10,0,0,0"
                    Background="#2196F3" Foreground="White"
                    Click="BtnConfirmBooking_Click"/>

			<Button Content="❌ Отменить" Width="120" Height="35" Margin="10,0,0,0"
                    Background="#F44336" Foreground="White"
                    Click="BtnCancelBooking_Click"/>

			<Button Content="👁️ Детали" Width="100" Height="35" Margin="10,0,0,0"
                    Click="BtnViewDetails_Click"/>

			<Button Content="🔄 Обновить" Width="100" Height="35" Margin="10,0,0,0"
                    Click="BtnRefresh_Click"/>
		</StackPanel>

		<!-- Панель фильтров -->
		<Border Grid.Row="1" Background="#F9F9F9" BorderBrush="#DDD" BorderThickness="1"
                Padding="10" Margin="0,0,0,10">
			<StackPanel>
				<!-- Поиск -->
				<StackPanel Orientation="Horizontal" Margin="0,0,0,5">
					<Label Content="Поиск:" VerticalAlignment="Center"/>
					<TextBox x:Name="txtSearch" Width="250" Height="25" Margin="5,0,20,0"
                             TextChanged="TxtSearch_TextChanged"/>

					<RadioButton x:Name="rbSearchClient" Content="По ФИО клиента"
                                 GroupName="SearchType" IsChecked="True" Margin="0,0,10,0"/>
					<RadioButton x:Name="rbSearchId" Content="По номеру заявки"
                                 GroupName="SearchType"/>
				</StackPanel>

				<!-- Фильтры -->
				<StackPanel Orientation="Horizontal">
					<Label Content="Статус:" VerticalAlignment="Center"/>
					<ComboBox x:Name="cmbStatus" Width="120" Height="25" Margin="5,0,20,0"
                              SelectionChanged="CmbStatus_SelectionChanged"/>

					<Label Content="Сортировка:" VerticalAlignment="Center"/>
					<ComboBox x:Name="cmbSort" Width="120" Height="25" Margin="5,0,0,0"
                              SelectionChanged="CmbSort_SelectionChanged">
						<ComboBoxItem Content="По дате (новые)"/>
						<ComboBoxItem Content="По дате (старые)"/>
						<ComboBoxItem Content="По сумме (↑)"/>
						<ComboBoxItem Content="По сумме (↓)"/>
					</ComboBox>
				</StackPanel>
			</StackPanel>
		</Border>

		<!-- Список заявок -->
		<DataGrid x:Name="dgBookings" Grid.Row="2"
                  AutoGenerateColumns="False" IsReadOnly="True"
                  CanUserAddRows="False" SelectionMode="Single">

			<DataGrid.Columns>
				<DataGridTextColumn Header="№" Binding="{Binding Id}" Width="50"/>
				<DataGridTextColumn Header="Клиент" Binding="{Binding ClientName}" Width="180"/>
				<DataGridTextColumn Header="Тур" Binding="{Binding TourName}" Width="200"/>
				<DataGridTextColumn Header="Дата брони"
                                    Binding="{Binding BookingDate, StringFormat=dd.MM.yyyy}"
                                    Width="100"/>
				<DataGridTextColumn Header="Кол-во" Binding="{Binding PeopleCount}" Width="70"/>
				<DataGridTextColumn Header="Сумма"
                                    Binding="{Binding TotalPrice, StringFormat=N0 руб.}"
                                    Width="110"/>
				<DataGridTemplateColumn Header="Статус" Width="120">
					<DataGridTemplateColumn.CellTemplate>
						<DataTemplate>
							<Border CornerRadius="3" Padding="5,2" Background="{Binding Status, Converter={StaticResource StatusColorConverter}}">
								<TextBlock Text="{Binding Status}"
                                           HorizontalAlignment="Center" FontWeight="SemiBold"
                                           Foreground="White"/>
							</Border>
						</DataTemplate>
					</DataGridTemplateColumn.CellTemplate>
				</DataGridTemplateColumn>
			</DataGrid.Columns>
		</DataGrid>

		<!-- Статистика -->
		<StackPanel Grid.Row="3" Orientation="Horizontal" Margin="0,10,0,0">
			<TextBlock Text="Всего заявок:" FontWeight="Bold"/>
			<TextBlock x:Name="tbTotalBookings" Text="0" FontWeight="Bold" Margin="5,0,20,0"/>

			<TextBlock Text="Новых:" FontWeight="Bold" Foreground="Orange"/>
			<TextBlock x:Name="tbNewBookings" Text="0" FontWeight="Bold" Foreground="Orange" Margin="5,0,20,0"/>

			<TextBlock Text="Подтверждённых:" FontWeight="Bold" Foreground="Green"/>
			<TextBlock x:Name="tbConfirmedBookings" Text="0" FontWeight="Bold" Foreground="Green" Margin="5,0,20,0"/>

			<TextBlock Text="Отменённых:" FontWeight="Bold" Foreground="Red"/>
			<TextBlock x:Name="tbCancelledBookings" Text="0" FontWeight="Bold" Foreground="Red" Margin="5,0,0,0"/>
		</StackPanel>
	</Grid>
</Page>